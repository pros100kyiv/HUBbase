# Покрокова налаштування проєкту на Vercel

Детальна інструкція: що натиснути і що ввести на кожному кроці.

---

## Частина 1. Підключення репозиторію

**Крок 1.1.** Відкрий у браузері: https://vercel.com  
**Крок 1.2.** Увійди в акаунт (GitHub / GitLab / Email).

**Крок 1.3.** На головній сторінці натисни кнопку **Add New** (або **New Project**).  
**Крок 1.4.** Обери **Project**.

**Крок 1.5.** Якщо репозиторій ще не підключений:
- Натисни **Import Git Repository**.
- Під **Recommended**, або в списку, знайди **GitHub** (або GitLab / Bitbucket).
- Натисни **Configure** біля потрібного сервісу і дозволь доступ до організації/репо.
- Повернись на екран імпорту.

**Крок 1.6.** У списку репозиторіїв знайди свій проєкт (наприклад `server` або назву репо) і натисни **Import** біля нього.

**Крок 1.7.** Відкриється екран **Configure Project**. Не натискай поки **Deploy** — спочатку додай змінні оточення (частина 2).

---

## Частина 2. Змінні оточення (Environment Variables)

**Крок 2.1.** На екрані **Configure Project** прокрути вниз до блоку **Environment Variables**.

**Крок 2.2.** Підготуй значення `DATABASE_URL`:
1. Відкрий у новій вкладці: https://console.neon.tech  
2. Увійди і вибери свій проєкт (базу даних).
3. На головній сторінці проєкту знайди **Connection string**.
4. У випадаючому списку вибери **Pooled** (не Direct). У рядку має з’явитися `-pooler` у хості.
5. Скопіюй весь рядок. Він має виглядати приблизно так:  
   `postgresql://user:password@ep-xxx-pooler.region.aws.neon.tech/neondb?sslmode=require`  
6. Якщо в кінці немає `?sslmode=require` — допиши вручну.

**Крок 2.3.** У Vercel в блоці **Environment Variables**:
- У поле **Key** введи: `DATABASE_URL`
- У поле **Value** встав скопійований рядок з Neon (не видаляй лапки, якщо Vercel підставляє).
- Поруч з полем **Value** є вибір середовища: постав галочки **Production**, **Preview**, **Development** (мінімум **Production**).
- Натисни **Add** (або **Save**), щоб змінна з’явилась у списку.

**Крок 2.4.** (Опційно) Якщо потрібен повний URL сайту:
- Key: `NEXT_PUBLIC_BASE_URL`
- Value: `https://xbase.online` (або твій домен).
- Знову **Add** / **Save**.

**Крок 2.5.** Переконайся, що в списку змінних є рядок з **DATABASE_URL**. Після цього можна деплоїти (частина 3).

---

## Частина 3. Перший деплой

**Крок 3.1.** На тому ж екрані **Configure Project** перевір:
- **Framework Preset:** Next.js (має підставитися сам).
- **Root Directory:** порожньо або `./` (якщо код у корені репо).
- **Build Command:** можна залишити порожнім — Vercel візьме з `package.json`: `prisma generate && next build`.
- **Output Directory:** не змінюй (для Next.js за замовчуванням).
- **Install Command:** за замовчуванням (наприклад `npm install`).

**Крок 3.2.** Натисни синю кнопку **Deploy** внизу екрану.

**Крок 3.3.** Дочекайся завершення збірки (1–3 хвилини). Статус буде **Building**, потім **Ready**. Якщо з’явиться червона помилка — відкрий **View Build Logs** і подивись текст помилки.

**Крок 3.4.** Після успішного деплою з’явиться посилання на сайт (типу `https://твій-проєкт.vercel.app`). Відкрий його — має відкритися головна сторінка.

---

## Частина 4. Міграції бази (щоб реєстрація не давала 503)

Таблиці в Neon мають бути створені/оновлені. Це робиться один раз.

### Варіант A: з комп’ютера (рекомендовано)

**Крок 4A.1.** На комп’ютері відкрий папку проєкту в терміналі (наприклад `cd c:\server`).

**Крок 4A.2.** Переконайся, що в папці є файл `.env`, а в ньому той самий `DATABASE_URL`, що й на Vercel (скопіюй з Neon, як у кроці 2.2).

**Крок 4A.3.** Виконай команду:
```bash
npx prisma migrate deploy
```

**Крок 4A.4.** У консолі має з’явитися щось на кшталт:  
`All migrations have been successfully applied` або перелік застосованих міграцій. Помилок бути не має.

**Крок 4A.5.** Нічого в Vercel міняти не потрібно — таблиці вже в Neon, додаток їх побачить.

### Варіант B: один раз через Vercel (якщо не хочеш запускати міграції з комп’ютера)

**Крок 4B.1.** У Vercel відкрий свій проєкт. У верхньому меню натисни **Settings**.

**Крок 4B.2.** У лівому сайдбарі вибери **General**. Прокрути до **Build & Development Settings**.

**Крок 4B.3.** Поле **Build Command** зміни на:
```bash
prisma generate && prisma migrate deploy && next build
```
Натисни **Save**.

**Крок 4B.4.** Перейди у вкладку **Deployments** (верхнє меню). Знайди останній деплой, натисни три крапки **⋯** біля нього і вибери **Redeploy**. Підтверди **Redeploy**.

**Крок 4B.5.** Дочекайся успішного завершення збірки (у логах має бути виконання міграцій без помилок).

**Крок 4B.6.** Повернись у **Settings** → **General** → **Build & Development Settings** і поверни **Build Command** назад на:
```bash
prisma generate && next build
```
Збережи. Так міграції не будуть запускатися при кожному деплої.

---

## Частина 5. Перевірка реєстрації

**Крок 5.1.** Відкрий свій сайт (посилання з Vercel або `https://xbase.online`, якщо вже налаштував домен).

**Крок 5.2.** Перейди на сторінку реєстрації (наприклад **Реєстрація** або `/register`).

**Крок 5.3.** Заповни форму новими даними (новий email, пароль, назва) і натисни кнопку реєстрації.

**Крок 5.4.** Якщо все ок — має з’явитися успіх або редірект у кабінет. Якщо знову «Сервіс тимчасово недоступний» (503) — переходи до частини 6.

---

## Частина 6. Якщо реєстрація все ще дає 503

**Крок 6.1.** У Vercel відкрий проєкт → **Deployments** → клік по останньому деплою.

**Крок 6.2.** Вгорі є вкладки **Building** / **Logs** (або **Runtime Logs**). Відкрий **Logs** / **Runtime Logs**.

**Крок 6.3.** Спробуй ще раз реєстрацію на сайті, потім онови логи. Шукай рядки:
- `[register 503] Database connection:` — означає, що Vercel не може підключитися до Neon (перевір **крок 2**: чи правильно вставлений `DATABASE_URL` у **Settings** → **Environment Variables** для **Production**).
- `[register 503] Database table missing:` — означає, що таблиці ще немає (обов’язково виконай **частину 4** — міграції).

**Крок 6.4.** Перевір змінні оточення:
- **Settings** → **Environment Variables**.
- Має бути змінна **DATABASE_URL** з галочкою **Production**. Якщо її немає або вона змінена після першого деплою — збережи і зроби **Redeploy** (Deployments → ⋯ → Redeploy).

---

## Частина 7. Підключення свого домену (наприклад xbase.online)

**Крок 7.1.** У Vercel: проєкт → **Settings** → у лівому меню **Domains**.

**Крок 7.2.** У поле введи домен, наприклад `xbase.online`, і натисни **Add**.

**Крок 7.3.** Vercel покаже, які записи додати в DNS (A або CNAME). Відкрий панель свого реєстратора домену (де купував домен) і додай ці записи так, як написано в Vercel.

**Крок 7.4.** Зачекай 5–60 хвилин (пропагація DNS). У Vercel статус домену має стати «Valid» з зеленим галочкою. Після цього сайт буде відкриватися по `https://xbase.online`.

---

## Короткий чеклист

- [ ] Репо імпортовано в Vercel (Add New → Project → Import).
- [ ] У Environment Variables додано **DATABASE_URL** (Neon, Pooled) для **Production**.
- [ ] Виконано **Deploy** і збірка пройшла успішно.
- [ ] Виконано міграції: локально `npx prisma migrate deploy` або один раз через Build Command (потім повернути команду назад).
- [ ] На сайті перевірена реєстрація — немає 503.
- [ ] За потреби додано домен у **Settings** → **Domains** і налаштовано DNS.

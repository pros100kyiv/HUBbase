# DATABASE_URL — детальний опис

Що це, звідки взяти і куди вставити.

---

## Що таке DATABASE_URL

**DATABASE_URL** — це один рядок (connection string), яким додаток підключається до бази даних PostgreSQL. У цьому проєкті використовується хмарна база **Neon**.

- У рядку зашиті: логін, пароль, адреса сервера, ім’я бази та параметри (наприклад SSL).
- Файл `.env` і змінні на Vercel не потрапляють у репозиторій і не показуються на клієнті — тільки на сервері.

У коді значення береться так (приклад з Prisma):

- У `prisma/schema.prisma`: `url = env("DATABASE_URL")`
- Локально читається з файлу `.env`
- На Vercel — з **Environment Variables**

Без правильно налаштованого **DATABASE_URL** реєстрація та вхід повертають помилку 503 (сервіс тимчасово недоступний).

---

## Формат рядка для Neon

Загальний вигляд:

```
postgresql://КОРИСТУВАЧ:ПАРОЛЬ@ХОСТ/ІМ_Я_БАЗИ?sslmode=require
```

Приклад (фейковий пароль):

```
postgresql://neondb_owner:abc123XYZ@ep-damp-violet-aiwg2d9h-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require
```

Що важливо:

- **КОРИСТУВАЧ** і **ПАРОЛЬ** — з Neon (не від Vercel і не від домену).
- **ХОСТ** для додатку має бути з **-pooler** у назві (з’єднання через пулер), наприклад:  
  `ep-xxx-pooler.region.aws.neon.tech`
- В кінці обов’язково **?sslmode=require** (Neon вимагає SSL).

Якщо в Neon у рядку вже є `?sslmode=require` — нічого не змінюй. Якщо немає — допиши вручну в кінець рядка.

---

## Де взяти DATABASE_URL (Neon) — покроково

**Крок 1.** Відкрий у браузері: https://console.neon.tech  

**Крок 2.** Увійди в акаунт (якщо потрібно — зареєструйся).

**Крок 3.** На головній сторінці після входу буде список проєктів. Клікни по потрібному проєкту (наприклад, де база `neondb`).

**Крок 4.** Відкриється дашборд проєкту. Знайди блок **Connection string** (або **Connect**).

**Крок 5.** Поруч зазвичай є вибір типу підключення:
- **Pooled connection** (рекомендовано для додатку)
- Direct connection  

Обери **Pooled** (або **Pooled connection**). У рядку в адресі має з’явитися **-pooler**, наприклад:  
`ep-xxx-pooler.us-east-1.aws.neon.tech`

**Крок 6.** Натисни кнопку **Copy** (або виділи рядок і скопіюй). Це і є значення для **DATABASE_URL**.

**Крок 7.** Перевір кінець рядка. Має бути щось на кшталт:  
`...neon.tech/neondb?sslmode=require`  
Якщо після назви бази немає `?sslmode=require`, допиши вручну:  
`?sslmode=require`

Підсумок: скопійований рядок з Neon (Pooled) + при потребі `?sslmode=require` = те, що треба вставити в **DATABASE_URL**.

---

## Куди вставити DATABASE_URL

### Локально (на комп’ютері)

**Крок 1.** У корені проєкту (там, де є `package.json` і папка `prisma`) відкрий або створи файл **`.env`**.

**Крок 2.** Додай один рядок (замість `...` — повний рядок з Neon):

```
DATABASE_URL="postgresql://..."
```

Рядок з Neon може містити лапки всередині; якщо так, зовнішні лапки мають бути, наприклад:

```
DATABASE_URL="postgresql://user:pass@host/db?sslmode=require"
```

**Крок 3.** Збережи файл. Файл `.env` не комітиться в git (зазвичай він у `.gitignore`).

Після цього команди на кшталт `npm run dev`, `npx prisma migrate deploy`, `npm run db:verify` будуть використовувати цей **DATABASE_URL**.

---

### На Vercel (для продакшену)

**Крок 1.** Відкрий https://vercel.com, увійди, вибери свій проєкт.

**Крок 2.** У верхньому меню натисни **Settings**.

**Крок 3.** У лівому меню вибери **Environment Variables**.

**Крок 4.** У блоці **Key** введи саме:  
`DATABASE_URL`  
(без пробілів, великі літери, як тут.)

**Крок 5.** У поле **Value** встав той самий рядок підключення з Neon (Pooled), який копіював раніше. Можна вставити з лапками або без — Vercel зазвичай приймає обидва варіанти.

**Крок 6.** Поруч з полем Value є вибір середовища. Постав галочку **Production** (обов’язково для продакшену). За бажанням можна ще **Preview** та **Development**.

**Крок 7.** Натисни **Save** або **Add**. У списку змінних має з’явитися рядок з ім’ям **DATABASE_URL** (значення буде приховано).

**Крок 8.** Якщо проєкт уже задеплоєний, після зміни змінних потрібен новий деплой:  
**Deployments** → три крапки біля останнього деплою → **Redeploy**.

Підсумок: на Vercel **DATABASE_URL** має бути в **Settings → Environment Variables**, з галочкою **Production**, і після зміни — **Redeploy**.

---

## Перевірка

- **Локально:** у папці проєкту виконай:
  ```bash
  npm run db:verify
  ```
  Якщо підключення успішне, у консолі буде щось на кшталт: «Підключення до бази успішне».

- **На Vercel:** після Redeploy відкрий сайт і спробуй **Реєстрацію**. Якщо з’єднання з базою є і міграції застосовані, реєстрація не повинна давати 503.

---

## Безпека

- Не публікуй **DATABASE_URL** у репозиторії, у скрінах і в публічних чатах.
- Не додавай файл `.env` у git (перевір, що `.env` є в `.gitignore`).
- Якщо пароль змістився — зміни його в Neon і оновіть значення **DATABASE_URL** локально та на Vercel, потім на Vercel зроби **Redeploy**.

---

## Коротко

| Питання | Відповідь |
|--------|-----------|
| Що таке DATABASE_URL? | Рядок підключення до PostgreSQL (Neon). |
| Де взяти? | Neon Console → проєкт → Connection string → **Pooled** → Copy. |
| Де вставити локально? | У файл **`.env`** у корені проєкту: `DATABASE_URL="postgresql://..."`. |
| Де вставити на продакшені? | Vercel → проєкт → **Settings** → **Environment Variables** → Key: `DATABASE_URL`, Value: рядок з Neon, середовище: **Production**, потім **Redeploy**. |
| Що перевірити в рядку? | У хості є **-pooler**, в кінці є **?sslmode=require**. |

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Business {
  id                           String                     @id @default(cuid())
  name                         String
  slug                         String                     @unique
  email                        String                     @unique
  password                     String?
  resetToken                   String?
  resetTokenExpiry             DateTime?
  googleId                     String?                    @unique
  telegramId                   BigInt?                    @unique
  phone                        String?
  address                      String?
  description                  String?
  logo                         String?
  avatar                       String?
  primaryColor                 String?                    @default("#C5A059")
  secondaryColor               String?                    @default("#FFFFFF")
  backgroundColor              String?                    @default("#050505")
  surfaceColor                 String?                    @default("#121212")
  hideRevenue                  Boolean                    @default(false)
  isActive                     Boolean                    @default(true)
  niche                        BusinessNiche              @default(OTHER)
  customNiche                  String?
  businessIdentifier           String?                    @unique
  profileCompleted             Boolean                    @default(false)
  settings                     String?
  businessCardBackgroundImage  String?
  slogan                       String?
  additionalInfo               String?
  socialMedia                  String?
  workingHours                 String?
  location                     String?
  telegramBotToken             String?
  telegramChatId               String?
  telegramNotificationsEnabled Boolean                    @default(false)
  telegramSettings             String?
  aiChatEnabled                Boolean                    @default(false)
  aiProvider                   String?
  aiApiKey                     String?
  aiSettings                   String?
  smsProvider                  String?
  smsApiKey                    String?
  smsSender                    String?
  emailProvider                String?
  emailApiKey                  String?
  emailFrom                    String?
  emailFromName                String?
  paymentProvider              String?
  paymentApiKey                String?
  paymentMerchantId            String?
  paymentEnabled               Boolean                    @default(false)
  remindersEnabled             Boolean                    @default(false)
  reminderSmsEnabled           Boolean                    @default(false)
  reminderEmailEnabled         Boolean                    @default(false)
  reminderTelegramEnabled      Boolean                    @default(false)
  trustedDevices               String?
  createdAt                    DateTime                   @default(now())
  updatedAt                    DateTime                   @updatedAt
  telegramWebhookSetAt         DateTime?
  subscriptionPlan             SubscriptionPlan           @default(FREE)
  trialEndsAt                  DateTime?
  subscriptionStatus           String?
  subscriptionCurrentPeriodEnd DateTime?
  aiChatMessages               AIChatMessage[]
  analytics                    AnalyticsReport[]
  appointments                 Appointment[]
  appointmentAccessTokens      AppointmentAccessToken[]
  appointmentChangeRequests    AppointmentChangeRequest[]
  appointmentEvents            AppointmentEvent[]
  broadcasts                   Broadcast[]
  aiSnapshot                   BusinessAiSnapshot?
  modules                      BusinessModule[]
  users                        BusinessUser[]
  clients                      Client[]
  clientSegments               ClientSegment[]
  exports                      DataExport[]
  imports                      DataImport[]
  masters                      Master[]
  notes                        Note[]
  payments                     Payment[]
  pushSubscriptions            PushSubscription[]
  reminderLogs                 ReminderLog[]
  services                     Service[]
  socialInboxMessages          SocialInboxMessage[]
  socialIntegrations           SocialIntegration[]
  telegramBroadcasts           TelegramBroadcast[]
  telegramChatMappings         TelegramChatMapping[]
  telegramReminders            TelegramReminder[]
  telegramUsers                TelegramUser[]
  smsMessages                  SMSMessage[]

  @@index([slug])
  @@index([email])
  @@index([googleId])
  @@index([niche])
  @@index([businessIdentifier])
}

model Master {
  id                    String                     @id @default(cuid())
  businessId            String
  name                  String
  photo                 String?
  bio                   String?
  rating                Float                      @default(0)
  isActive              Boolean                    @default(true)
  workingHours          String?
  scheduleDateOverrides String?
  totalAppointments     Int                        @default(0)
  totalRevenue          BigInt                     @default(0)
  averageRating         Float                      @default(0)
  utilizationRate       Float                      @default(0)
  metadata              String?
  createdAt             DateTime                   @default(now())
  updatedAt             DateTime                   @updatedAt
  appointments          Appointment[]
  changeRequests        AppointmentChangeRequest[]
  business              Business                   @relation(fields: [businessId], references: [id], onDelete: Cascade)
  utilizationMetrics    MasterUtilization[]

  @@index([businessId])
  @@index([isActive])
}

model Service {
  id          String   @id @default(cuid())
  businessId  String
  name        String
  price       Int
  duration    Int
  category    String?
  subcategory String?
  description String?
  image       String?
  isActive    Boolean  @default(true)
  masterIds   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  business    Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
}

model Client {
  id                   String             @id @default(cuid())
  businessId           String
  name                 String
  phone                String
  email                String?
  telegramChatId       String?
  totalAppointments    Int                @default(0)
  totalSpent           BigInt             @default(0)
  averageOrderValue    BigInt             @default(0)
  lifetimeValue        BigInt             @default(0)
  firstAppointmentDate DateTime?
  lastAppointmentDate  DateTime?
  retentionRate        Float              @default(0)
  isActive             Boolean            @default(true)
  status               String             @default("new")
  notes                String?
  tags                 String?
  metadata             String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  appointments         Appointment[]
  business             Business           @relation(fields: [businessId], references: [id], onDelete: Cascade)
  payments             Payment[]
  telegramReminders    TelegramReminder[]
  smsMessages          SMSMessage[]

  @@unique([businessId, phone])
  @@index([businessId])
  @@index([phone])
  @@index([isActive])
  @@index([businessId, status])
}

model Appointment {
  id                  String                     @id @default(cuid())
  businessId          String
  masterId            String
  clientId            String?
  clientName          String
  clientPhone         String
  clientEmail         String?
  startTime           DateTime
  endTime             DateTime
  status              String                     @default("Pending")
  services            String
  customServiceName   String?
  customPrice         Int?
  procedureDone       String?
  notes               String?
  reminderSent        Boolean                    @default(false)
  isRecurring         Boolean                    @default(false)
  recurrencePattern   String?
  recurrenceEndDate   DateTime?
  parentAppointmentId String?
  isFromBooking       Boolean                    @default(false)
  source              String?
  campaignId          String?
  telegramChatId      String?
  businessNote        String?
  createdAt           DateTime                   @default(now())
  updatedAt           DateTime                   @updatedAt
  business            Business                   @relation(fields: [businessId], references: [id], onDelete: Cascade)
  client              Client?                    @relation(fields: [clientId], references: [id])
  master              Master                     @relation(fields: [masterId], references: [id], onDelete: Cascade)
  accessToken         AppointmentAccessToken?
  changeRequests      AppointmentChangeRequest[]
  events              AppointmentEvent[]
  payments            Payment[]
  pushSubscriptions   PushSubscription[]
  reminderLogs        ReminderLog[]

  @@index([businessId])
  @@index([masterId])
  @@index([clientId])
  @@index([startTime])
  @@index([clientPhone])
  @@index([status])
  @@index([businessId, startTime])
  @@index([businessId, status])
}

model AppointmentAccessToken {
  id            String      @id @default(cuid())
  businessId    String
  appointmentId String      @unique
  tokenHash     String      @unique
  userAgent     String?
  ip            String?
  revokedAt     DateTime?
  createdAt     DateTime    @default(now())
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  business      Business    @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([tokenHash])
}

model PushSubscription {
  id            String      @id @default(cuid())
  businessId    String
  appointmentId String
  endpoint      String
  p256dh        String
  auth          String
  userAgent     String?
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  business      Business    @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([appointmentId, endpoint])
  @@index([businessId])
  @@index([appointmentId])
}

model AppointmentChangeRequest {
  id                 String                         @id @default(cuid())
  businessId         String
  appointmentId      String
  masterId           String
  type               AppointmentChangeRequestType
  status             AppointmentChangeRequestStatus @default(PENDING)
  requestedStartTime DateTime?
  requestedEndTime   DateTime?
  clientNote         String?
  decisionNote       String?
  decidedAt          DateTime?
  decidedBy          String?
  createdAt          DateTime                       @default(now())
  updatedAt          DateTime                       @updatedAt
  appointment        Appointment                    @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  business           Business                       @relation(fields: [businessId], references: [id], onDelete: Cascade)
  master             Master                         @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@index([businessId, status])
  @@index([appointmentId])
  @@index([masterId])
  @@index([createdAt])
}

model AppointmentEvent {
  id            String      @id @default(cuid())
  businessId    String
  appointmentId String
  type          String
  data          String?
  createdAt     DateTime    @default(now())
  appointment   Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  business      Business    @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([appointmentId])
  @@index([createdAt])
}

model ReminderLog {
  id            String          @id @default(cuid())
  businessId    String
  appointmentId String
  channel       ReminderChannel
  status        ReminderStatus  @default(SENT)
  triggeredBy   String          @default("manual")
  error         String?
  createdAt     DateTime        @default(now())
  appointment   Appointment     @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
  business      Business        @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([appointmentId])
  @@index([createdAt])
}

model BusinessUser {
  id          String    @id @default(cuid())
  businessId  String
  email       String
  password    String?
  name        String
  role        UserRole  @default(VIEWER)
  permissions String?
  isActive    Boolean   @default(true)
  lastLogin   DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  business    Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, email])
  @@index([businessId])
  @@index([email])
}

model MasterUtilization {
  id                String   @id @default(cuid())
  masterId          String
  date              DateTime
  totalHours        Float    @default(0)
  bookedHours       Float    @default(0)
  utilizationRate   Float    @default(0)
  appointmentsCount Int      @default(0)
  revenue           BigInt   @default(0)
  averageRating     Float    @default(0)
  metadata          String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  master            Master   @relation(fields: [masterId], references: [id], onDelete: Cascade)

  @@unique([masterId, date])
  @@index([masterId])
  @@index([date])
}

model AnalyticsReport {
  id         String    @id @default(cuid())
  businessId String
  name       String
  type       String
  period     String
  startDate  DateTime?
  endDate    DateTime?
  filters    String?
  data       String
  isPublic   Boolean   @default(false)
  createdBy  String?
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt
  business   Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([type])
  @@index([createdAt])
}

model DataImport {
  id           String   @id @default(cuid())
  businessId   String
  filename     String
  type         String
  status       String   @default("pending")
  totalRows    Int      @default(0)
  importedRows Int      @default(0)
  failedRows   Int      @default(0)
  errors       String?
  fileUrl      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  business     Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([status])
  @@index([createdAt])
}

model DataExport {
  id           String    @id @default(cuid())
  businessId   String
  filename     String
  type         String
  format       String    @default("csv")
  status       String    @default("pending")
  filters      String?
  startDate    DateTime?
  endDate      DateTime?
  fileUrl      String?
  fileSize     BigInt?
  rowsExported Int       @default(0)
  createdBy    String?
  expiresAt    DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  business     Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([status])
  @@index([createdAt])
}

model TelegramUser {
  id                   String    @id @default(cuid())
  telegramId           BigInt    @unique
  businessId           String
  username             String?
  firstName            String?
  lastName             String?
  role                 UserRole  @default(VIEWER)
  permissions          String?
  isActive             Boolean   @default(true)
  language             String    @default("uk")
  notificationsEnabled Boolean   @default(true)
  activationPassword   String?
  activatedAt          DateTime?
  lastActivity         DateTime?
  createdAt            DateTime  @default(now())
  updatedAt            DateTime  @updatedAt
  business             Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, telegramId])
  @@index([businessId])
  @@index([telegramId])
  @@index([activationPassword])
}

model TelegramVerification {
  id           String    @id @default(cuid())
  code         String    @unique
  telegramId   BigInt
  telegramData String?
  action       String
  deviceId     String?
  businessId   String?
  expiresAt    DateTime
  verified     Boolean   @default(false)
  verifiedAt   DateTime?
  createdAt    DateTime  @default(now())

  @@index([code])
  @@index([telegramId])
  @@index([expiresAt])
}

model TelegramChatMapping {
  id         String   @id @default(cuid())
  chatId     String   @unique
  businessId String
  createdAt  DateTime @default(now())
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
}

model TelegramLog {
  id             String   @id @default(cuid())
  businessId     String
  telegramUserId String?
  action         String
  command        String?
  message        String?
  metadata       String?
  createdAt      DateTime @default(now())

  @@index([businessId])
  @@index([createdAt])
  @@index([action])
}

model TelegramBroadcast {
  id          String    @id @default(cuid())
  businessId  String
  title       String
  message     String
  targetRole  UserRole?
  status      String    @default("draft")
  scheduledAt DateTime?
  sentAt      DateTime?
  sentCount   Int       @default(0)
  failedCount Int       @default(0)
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  business    Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([status])
  @@index([scheduledAt])
  @@index([createdAt])
}

model TelegramReminder {
  id          String    @id @default(cuid())
  businessId  String
  message     String
  targetType  String    @default("all")
  clientId    String?
  scheduledAt DateTime?
  sentAt      DateTime?
  status      String    @default("pending")
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  business    Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)
  client      Client?   @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([status])
  @@index([scheduledAt])
  @@index([clientId])
  @@index([createdAt])
}

model AIChatMessage {
  id         String   @id @default(cuid())
  businessId String
  sessionId  String
  role       String
  message    String
  metadata   String?
  createdAt  DateTime @default(now())
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([sessionId])
  @@index([createdAt])
}

model BusinessAiSnapshot {
  id         String   @id @default(cuid())
  businessId String   @unique
  snapshot   String
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([updatedAt])
}

model Broadcast {
  id            String       @id @default(cuid())
  businessId    String
  title         String
  message       String
  type          String
  targetType    String
  targetSegment String?
  targetClients String?
  status        String       @default("draft")
  scheduledAt   DateTime?
  sentAt        DateTime?
  sentCount     Int          @default(0)
  failedCount   Int          @default(0)
  smsCount      Int          @default(0)
  emailCount    Int          @default(0)
  metadata      String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  business      Business     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  smsMessages   SMSMessage[]

  @@index([businessId])
  @@index([status])
  @@index([scheduledAt])
}

model Payment {
  id                String       @id @default(cuid())
  businessId        String
  appointmentId     String?
  clientId          String?
  amount            BigInt
  currency          String       @default("UAH")
  status            String
  provider          String?
  providerPaymentId String?
  paymentUrl        String?
  returnUrl         String?
  metadata          String?
  paidAt            DateTime?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt
  appointment       Appointment? @relation(fields: [appointmentId], references: [id])
  business          Business     @relation(fields: [businessId], references: [id], onDelete: Cascade)
  client            Client?      @relation(fields: [clientId], references: [id])

  @@index([businessId])
  @@index([appointmentId])
  @@index([clientId])
  @@index([status])
  @@index([providerPaymentId])
}

model ClientSegment {
  id          String   @id @default(cuid())
  businessId  String
  name        String
  criteria    String
  clientCount Int      @default(0)
  autoUpdate  Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  business    Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
}

model SMSMessage {
  id                String     @id @default(cuid())
  businessId        String
  phone             String
  message           String
  status            String     @default("pending")
  clientId          String?
  broadcastId       String?
  providerMessageId String?
  errorMessage      String?
  sentAt            DateTime?
  deliveredAt       DateTime?
  createdAt         DateTime   @default(now())
  updatedAt         DateTime   @updatedAt
  broadcast         Broadcast? @relation(fields: [broadcastId], references: [id])
  business          Business   @relation(fields: [businessId], references: [id], onDelete: Cascade)
  client            Client?    @relation(fields: [clientId], references: [id])

  @@index([businessId])
  @@index([clientId])
  @@index([broadcastId])
  @@index([status])
  @@index([phone])
  @@index([createdAt])
  @@map("sms_messages")
}

model SocialIntegration {
  id           String    @id @default(cuid())
  businessId   String
  platform     String
  isConnected  Boolean   @default(false)
  accessToken  String?
  refreshToken String?
  userId       String?
  username     String?
  metadata     String?
  expiresAt    DateTime?
  lastSyncAt   DateTime?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  business     Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, platform])
  @@index([businessId])
  @@index([platform])
  @@index([isConnected])
}

model SocialInboxMessage {
  id             String   @id @default(cuid())
  businessId     String
  platform       String
  direction      String   @default("inbound")
  externalId     String?
  externalChatId String?
  senderId       String?
  senderName     String
  message        String
  isRead         Boolean  @default(false)
  replyToId      String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  business       Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([businessId, platform])
  @@index([createdAt])
  @@index([isRead])
}

model Note {
  id         String   @id @default(cuid())
  businessId String
  text       String
  completed  Boolean  @default(false)
  date       DateTime
  order      Int      @default(0)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  business   Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([date])
  @@index([businessId, date])
}

model BusinessModule {
  id          String    @id @default(cuid())
  businessId  String
  moduleKey   String
  moduleName  String
  isEnabled   Boolean   @default(true)
  settings    String?
  metadata    String?
  activatedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  business    Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, moduleKey])
  @@index([businessId])
  @@index([moduleKey])
  @@index([isEnabled])
}

model ManagementCenter {
  id                           String        @id @default(cuid())
  businessId                   String        @unique
  name                         String
  slug                         String        @unique
  email                        String        @unique
  password                     String?
  resetToken                   String?
  resetTokenExpiry             DateTime?
  googleId                     String?       @unique
  telegramId                   BigInt?       @unique
  phone                        String?
  address                      String?
  description                  String?
  logo                         String?
  avatar                       String?
  primaryColor                 String?       @default("#C5A059")
  secondaryColor               String?       @default("#FFFFFF")
  backgroundColor              String?       @default("#050505")
  surfaceColor                 String?       @default("#121212")
  hideRevenue                  Boolean       @default(false)
  isActive                     Boolean       @default(true)
  niche                        BusinessNiche @default(OTHER)
  customNiche                  String?
  businessIdentifier           String?       @unique
  profileCompleted             Boolean       @default(false)
  settings                     String?
  businessCardBackgroundImage  String?
  slogan                       String?
  additionalInfo               String?
  socialMedia                  String?
  workingHours                 String?
  location                     String?
  telegramBotToken             String?
  telegramChatId               String?
  telegramNotificationsEnabled Boolean       @default(false)
  telegramSettings             String?
  aiChatEnabled                Boolean       @default(false)
  aiProvider                   String?
  aiApiKey                     String?
  aiSettings                   String?
  smsProvider                  String?
  smsApiKey                    String?
  smsSender                    String?
  emailProvider                String?
  emailApiKey                  String?
  emailFrom                    String?
  emailFromName                String?
  paymentProvider              String?
  paymentApiKey                String?
  paymentMerchantId            String?
  paymentEnabled               Boolean       @default(false)
  remindersEnabled             Boolean       @default(false)
  reminderSmsEnabled           Boolean       @default(false)
  reminderEmailEnabled         Boolean       @default(false)
  registrationType             String
  registeredAt                 DateTime      @default(now())
  lastLoginAt                  DateTime?
  lastSeenAt                   DateTime?
  createdAt                    DateTime      @default(now())
  updatedAt                    DateTime      @updatedAt

  @@index([businessId])
  @@index([email])
  @@index([phone])
  @@index([registrationType])
  @@index([registeredAt])
  @@index([isActive])
  @@index([niche])
  @@index([businessIdentifier])
}

model PhoneDirectory {
  id           String        @id @default(cuid())
  phone        String
  category     PhoneCategory
  businessId   String?
  clientId     String?
  businessName String?
  clientName   String?
  notes        String?
  isActive     Boolean       @default(true)
  isVerified   Boolean       @default(false)
  lastUsedAt   DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt

  @@unique([phone, category, businessId])
  @@index([phone])
  @@index([category])
  @@index([businessId])
  @@index([clientId])
  @@index([isActive])
  @@index([createdAt])
}

model GraphNode {
  id                String              @id @default(cuid())
  nodeType          NodeType
  originalId        String              @unique
  businessId        String?
  properties        String
  labels            String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  fromRelationships GraphRelationship[] @relation("FromNode")
  toRelationships   GraphRelationship[] @relation("ToNode")

  @@index([nodeType])
  @@index([originalId])
  @@index([businessId])
  @@index([createdAt])
}

model GraphRelationship {
  id               String           @id @default(cuid())
  relationshipType RelationshipType
  fromNodeId       String
  toNodeId         String
  businessId       String?
  properties       String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  fromNode         GraphNode        @relation("FromNode", fields: [fromNodeId], references: [id], onDelete: Cascade)
  toNode           GraphNode        @relation("ToNode", fields: [toNodeId], references: [id], onDelete: Cascade)

  @@unique([fromNodeId, toNodeId, relationshipType])
  @@index([relationshipType])
  @@index([fromNodeId])
  @@index([toNodeId])
  @@index([businessId])
  @@index([createdAt])
}

model Admin {
  id          String    @id @default(cuid())
  email       String    @unique
  password    String
  name        String?
  role        AdminRole @default(ADMIN)
  permissions String?
  isActive    Boolean   @default(true)
  lastLoginAt DateTime?
  createdBy   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([email])
  @@index([role])
  @@index([isActive])
  @@index([createdAt])
}

model SystemSetting {
  key       String   @id
  value     String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BusinessNiche {
  SALON
  BARBERSHOP
  STO
  CAR_WASH
  SPA
  FITNESS
  BEAUTY
  TIRE_SERVICE
  EDUCATION
  MEDICINE
  RESTAURANT
  OTHER
}

enum SubscriptionPlan {
  FREE
  START
  BUSINESS
  PRO
}

enum UserRole {
  OWNER
  ADMIN
  MANAGER
  EMPLOYEE
  VIEWER
  CLIENT
  DEVELOPER
}

enum AppointmentChangeRequestType {
  RESCHEDULE
  CANCEL
}

enum AppointmentChangeRequestStatus {
  PENDING
  APPROVED
  REJECTED
  WITHDRAWN
}

enum ReminderChannel {
  PUSH
  SMS
  EMAIL
  TELEGRAM
}

enum ReminderStatus {
  SENT
  FAILED
}

enum PhoneCategory {
  BUSINESS
  CLIENT
}

enum NodeType {
  BUSINESS
  CLIENT
  MASTER
  SERVICE
  APPOINTMENT
  USER
  PAYMENT
  BROADCAST
}

enum RelationshipType {
  OWNS
  HAS
  PROVIDES
  BOOKED_BY
  PERFORMED_BY
  INCLUDES
  PAYS
  RECEIVES
  SENDS
  BELONGS_TO
  WORKS_FOR
  CREATED_BY
}

enum AdminRole {
  SUPER_ADMIN
  ADMIN
  VIEWER
}

enum AdminPermission {
  VIEW_BUSINESSES
  EDIT_BUSINESSES
  DELETE_BUSINESSES
  VIEW_CLIENTS
  VIEW_ANALYTICS
  VIEW_FINANCES
  MANAGE_ADMINS
  EXPORT_DATA
}
